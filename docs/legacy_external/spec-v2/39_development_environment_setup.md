# Development Environment Setup

**Purpose**: Standardized development environment for Laravel + Inertia + Vue 3 read-a-thon platform

## Development Stack Requirements

### Core Technologies
- **PHP**: 8.1+
- **Node.js**: 18.x LTS
- **MySQL**: 8.0+ (or MariaDB 10.6+)
- **Laravel**: 10.x
- **Vue.js**: 3.x
- **Inertia.js**: 1.x

### Development Tools
- **Composer**: 2.x (PHP dependency management)
- **NPM/Yarn**: Package management for frontend
- **Vite**: Frontend build tool and dev server
- **PHPUnit**: Backend testing framework
- **Vitest**: Frontend testing framework

## Local Development Setup

### Option A: Native Installation

#### System Requirements
**macOS/Linux**:
```bash
# PHP 8.1 with extensions
brew install php@8.1 composer

# Node.js 18 LTS
brew install node@18

# MySQL
brew install mysql
brew services start mysql
```

**Windows**:
- XAMPP/WAMP with PHP 8.1+
- Node.js from official website
- MySQL via XAMPP or standalone

#### Required PHP Extensions
```ini
extension=pdo_mysql
extension=mbstring
extension=openssl
extension=tokenizer
extension=xml
extension=ctype
extension=json
extension=bcmath
extension=fileinfo
extension=gd
```

### Option B: Docker Development Environment

#### Docker Compose Configuration
**File**: `docker-compose.yml`

```yaml
version: '3.8'

services:
  app:
    build: 
      context: .
      dockerfile: docker/app/Dockerfile
    volumes:
      - .:/var/www/html
      - ./docker/app/php.ini:/usr/local/etc/php/conf.d/custom.ini
    ports:
      - "8000:80"
    environment:
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
      - mailhog

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: readathon_root
      MYSQL_DATABASE: readathon_dev
      MYSQL_USER: readathon_user  
      MYSQL_PASSWORD: readathon_pass
    volumes:
      - mysql_data:/var/lib/mysql
      - ./docker/mysql/init:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"

  redis:
    image: redis:alpine
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"

  mailhog:
    image: mailhog/mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI

  node:
    image: node:18-alpine
    working_dir: /app
    volumes:
      - .:/app
    command: npm run dev
    ports:
      - "5173:5173"  # Vite dev server

volumes:
  mysql_data:
  redis_data:
```

#### Application Dockerfile
**File**: `docker/app/Dockerfile`

```dockerfile
FROM php:8.1-apache

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
    && docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Install Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Configure Apache
COPY docker/app/vhost.conf /etc/apache2/sites-available/000-default.conf
RUN a2enmod rewrite

# Set working directory
WORKDIR /var/www/html

# Copy application code
COPY . .
RUN chown -R www-data:www-data /var/www/html \
    && chmod -R 755 /var/www/html/storage
```

### Option C: Laravel Sail (Recommended)

#### Installation
```bash
# Clone project
git clone <repository-url> readathon-app
cd readathon-app

# Install dependencies via Docker
docker run --rm \
    -u "$(id -u):$(id -g)" \
    -v $(pwd):/var/www/html \
    -w /var/www/html \
    laravelsail/php81-composer:latest \
    composer install --ignore-platform-reqs

# Configure Sail
./vendor/bin/sail install --with=mysql,redis,mailhog

# Start development environment
./vendor/bin/sail up -d
```

#### Sail Configuration
**File**: `docker-compose.yml` (generated by Sail)

```yaml
services:
    laravel.test:
        build:
            context: ./vendor/laravel/sail/runtimes/8.1
            dockerfile: Dockerfile
        image: sail-8.1/app
        extra_hosts:
            - 'host.docker.internal:host-gateway'
        ports:
            - '${APP_PORT:-80}:80'
            - '${VITE_PORT:-5173}:${VITE_PORT:-5173}'
        environment:
            WWWUSER: '${WWWUSER}'
            LARAVEL_SAIL: 1
        volumes:
            - '.:/var/www/html'
        networks:
            - sail
        depends_on:
            - mysql
            - redis
            - mailhog
```

## Environment Configuration

### Environment Variables
**File**: `.env`

```env
# Application
APP_NAME="Read-a-thon Platform"
APP_ENV=local
APP_KEY=base64:your-generated-app-key
APP_DEBUG=true
APP_URL=http://localhost

# Database
DB_CONNECTION=mysql
DB_HOST=mysql  # or localhost for native
DB_PORT=3306
DB_DATABASE=readathon_dev
DB_USERNAME=readathon_user
DB_PASSWORD=readathon_pass

# Cache & Session
CACHE_DRIVER=redis  # or file for simple setup
SESSION_DRIVER=redis  # or file for simple setup
REDIS_HOST=redis  # or 127.0.0.1 for native

# Mail (Development)
MAIL_MAILER=smtp
MAIL_HOST=mailhog  # or localhost for native
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS=noreply@readathon-dev.local
MAIL_FROM_NAME="${APP_NAME}"

# External Services (Development)
SQUARE_ENVIRONMENT=sandbox
SQUARE_APPLICATION_ID=your-sandbox-app-id
SQUARE_ACCESS_TOKEN=your-sandbox-access-token
SQUARE_WEBHOOK_SIGNATURE_KEY=your-sandbox-webhook-key

# Open Library API
OPEN_LIBRARY_BASE_URL=https://openlibrary.org/api
BOOK_LOOKUP_CACHE_TTL=10080  # 7 days in minutes
BOOK_LOOKUP_RATE_LIMIT=30    # Per minute

# Feature Flags
FEATURE_BARCODE_SCANNING=true
FEATURE_IMMEDIATE_PAYMENTS=true
FEATURE_EMAIL_TEMPLATES=true
FEATURE_STUDENT_LOGIN=true

# Logging
LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

# Broadcasting (if needed for real-time features)
BROADCAST_DRIVER=log
```

### Database Setup

#### Initial Migration and Seeding
```bash
# Run migrations
php artisan migrate

# Seed development data
php artisan db:seed --class=DevelopmentSeeder

# Create admin user
php artisan make:admin admin@readathon-dev.local
```

#### Development Seeders
**File**: `database/seeders/DevelopmentSeeder.php`

```php
class DevelopmentSeeder extends Seeder
{
    public function run()
    {
        // Create development schools
        $school = School::create([
            'name' => 'Janney Elementary School',
            'subdomain' => 'janney-dev',
            'timezone' => 'America/New_York'
        ]);

        // Create development events
        $event = Event::create([
            'school_id' => $school->id,
            'name' => 'Spring 2024 Read-a-thon',
            'start_date' => now()->addDays(7),
            'end_date' => now()->addDays(21),
            'is_active' => true
        ]);

        // Create test families
        $this->createTestFamilies($school, $event);
        
        // Create email templates
        $this->createEmailTemplates($school);
    }
}
```

### Frontend Development Setup

#### Package Installation
```bash
# Install Node dependencies
npm install

# Development build with hot reload
npm run dev

# Production build
npm run build

# Type checking
npm run type-check

# Linting
npm run lint
```

#### Vite Configuration
**File**: `vite.config.js`

```javascript
import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';
import vue from '@vitejs/plugin-vue';

export default defineConfig({
    plugins: [
        laravel({
            input: 'resources/js/app.js',
            refresh: true,
        }),
        vue({
            template: {
                transformAssetUrls: {
                    base: null,
                    includeAbsolute: false,
                },
            },
        }),
    ],
    server: {
        host: '0.0.0.0',  // For Docker compatibility
        port: 5173,
        hmr: {
            host: 'localhost'
        }
    },
    resolve: {
        alias: {
            '@': '/resources/js',
            '@components': '/resources/js/Components',
            '@pages': '/resources/js/Pages',
            '@stores': '/resources/js/stores'
        }
    }
});
```

## IDE and Editor Setup

### VS Code Configuration

#### Extensions
**File**: `.vscode/extensions.json`

```json
{
    "recommendations": [
        "bmewburn.vscode-intelephense-client",
        "Vue.volar",
        "bradlc.vscode-tailwindcss",
        "ms-vscode.vscode-typescript-next",
        "esbenp.prettier-vscode",
        "ms-vscode.phpcs",
        "rifi2k.format-html-in-php"
    ]
}
```

#### Settings
**File**: `.vscode/settings.json`

```json
{
    "php.validate.executablePath": "/usr/bin/php",
    "php.suggest.basic": false,
    "typescript.preferences.quoteStyle": "single",
    "vue.server.hybridMode": true,
    "prettier.requireConfig": true,
    "editor.formatOnSave": true,
    "editor.codeActionsOnSave": {
        "source.fixAll.eslint": true
    },
    "files.associations": {
        "*.blade.php": "blade"
    }
}
```

#### Debugging Configuration
**File**: `.vscode/launch.json`

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Listen for Xdebug",
            "type": "php",
            "request": "launch", 
            "port": 9003,
            "pathMappings": {
                "/var/www/html": "${workspaceFolder}"
            }
        },
        {
            "name": "Launch Chrome",
            "type": "chrome",
            "request": "launch",
            "url": "http://localhost:8000",
            "webRoot": "${workspaceFolder}/public"
        }
    ]
}
```

### PhpStorm Configuration

#### Laravel Plugin Setup
- Install Laravel Plugin
- Configure PHP interpreter (local or Docker)
- Set up Laravel framework integration
- Configure Composer and PHPUnit

#### Database Connection
- Connect to MySQL (localhost:3306 or Docker)
- Import database schema for autocomplete
- Configure Laravel Eloquent support

## Testing Environment Setup

### Local Testing Configuration
**File**: `.env.testing`

```env
APP_ENV=testing
DB_CONNECTION=sqlite
DB_DATABASE=:memory:
CACHE_DRIVER=array
SESSION_DRIVER=array
QUEUE_CONNECTION=sync
MAIL_MAILER=array

# Mock external services in testing
SQUARE_ENVIRONMENT=mock
OPEN_LIBRARY_BASE_URL=mock
```

### Testing Tools Installation
```bash
# Install testing dependencies
composer require --dev mockery/mockery
composer require --dev pestphp/pest
composer require --dev pestphp/pest-plugin-laravel

# Frontend testing
npm install --save-dev @testing-library/vue
npm install --save-dev jsdom
npm install --save-dev @vue/test-utils
```

### Test Database Setup
```bash
# Create test database
php artisan migrate --env=testing

# Run tests
php artisan test

# Run with coverage
php artisan test --coverage
```

## Performance Monitoring Setup

### Local Debugging Tools

#### Laravel Telescope
```bash
composer require laravel/telescope --dev
php artisan telescope:install
php artisan migrate
```

#### Laravel Debugbar
```bash  
composer require barryvdh/laravel-debugbar --dev
php artisan vendor:publish --provider="Barryvdh\Debugbar\ServiceProvider"
```

### Frontend Performance Tools
```bash
# Bundle analysis
npm run build -- --analyze

# Vue DevTools
# Install browser extension for development
```

## Security Setup

### Development Security Tools

#### PHP Security Scanner
```bash
composer require --dev roave/security-advisories
composer audit
```

#### NPM Security Audit
```bash
npm audit
npm audit fix
```

### Local HTTPS Setup (Optional)

#### Laravel Valet (macOS)
```bash
composer global require laravel/valet
valet install
valet secure readathon-dev
```

#### mkcert (Cross-platform)
```bash
# Install mkcert
brew install mkcert  # macOS
# or download from GitHub for Windows/Linux

# Create local CA
mkcert -install

# Generate certificates
mkcert readathon-dev.local localhost 127.0.0.1
```

## Troubleshooting Common Issues

### Docker Issues
```bash
# Reset Docker environment
docker-compose down -v
docker-compose up --build -d

# Clear Laravel caches
docker-compose exec app php artisan cache:clear
docker-compose exec app php artisan config:clear
docker-compose exec app php artisan route:clear
```

### Permission Issues (macOS/Linux)
```bash
# Fix storage permissions
sudo chown -R $(whoami):www-data storage
sudo chown -R $(whoami):www-data bootstrap/cache
chmod -R 775 storage
chmod -R 775 bootstrap/cache
```

### Database Connection Issues
```bash
# Test MySQL connection
mysql -h localhost -u readathon_user -p readathon_dev

# Reset database
php artisan migrate:fresh --seed
```

### Node/NPM Issues
```bash
# Clear Node caches
npm cache clean --force
rm -rf node_modules package-lock.json
npm install

# Fix permissions (macOS/Linux)
sudo chown -R $(whoami) ~/.npm
```

## Development Workflow

### Daily Development Process
1. **Start Environment**: `./vendor/bin/sail up -d` or `docker-compose up -d`
2. **Frontend Development**: `npm run dev` (hot reload)
3. **Backend Changes**: Automatic reload with Laravel
4. **Testing**: `php artisan test` and `npm run test`
5. **Commit**: `git add . && git commit -m "feature: description"`

### Code Quality Checks
```bash
# Pre-commit checks
composer run lint
npm run lint
php artisan test
npm run test
npm run type-check
```

### Environment Maintenance
```bash
# Weekly maintenance
composer update
npm update
php artisan migrate:status
docker system prune  # Clean unused Docker resources
```