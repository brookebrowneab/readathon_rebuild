# Migration Audit Decisions (Claude Reference → Main Repo)

Status: **No KEEP items identified.** All items require **REFACTOR** or **REBUILD** to meet contract, legacy schema, or UI parity requirements.

## Backend Endpoints

| Item | Type | KEEP/REFACTOR/REBUILD | Why | Required changes | Depends on | Claude source → Main repo target |
|---|---|---|---|---|---|---|
| `GET /api/health` | backend | REBUILD | Not in contract; response envelope mismatch. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/config/routes.php` → none (drop) |
| `GET /api/auth/csrf-token` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → none (drop) |
| `POST /api/auth/register` | backend | REBUILD | Contract uses `/auth/signup` with different payload/response. | Implement `/api/auth/signup` per contract envelope. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/AuthController.php` (new) |
| `POST /api/auth/login` | backend | REBUILD | Contract uses `/auth/token` with different payload/response. | Implement `/api/auth/token` per contract envelope. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/AuthController.php` (new) |
| `POST /api/auth/logout` | backend | REBUILD | Envelope mismatch and auth model differs. | Rebuild to contract response envelope. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/AuthController.php` (new) |
| `GET /api/auth/me` | backend | REBUILD | Contract uses `/api/me/*` scoped endpoints. | Implement `/api/me/*` endpoints. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/MeController.php` (new) |
| `POST /api/auth/forgot-password` | backend | REBUILD | Contract only defines `student-forgot-password` function. | Replace with contract function. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/StudentAuthController.php` |
| `POST /api/auth/reset-password` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → none (drop) |
| `POST /api/auth/student-login` | backend | REBUILD | Contract uses `/api/functions/student-login` with student session scope. | Implement contract path + session storage. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → `backend/src/Controller/StudentAuthController.php` |
| `POST /api/auth/magic-link` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → none (drop) |
| `POST /api/auth/magic-verify` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/AuthController.php` → none (drop) |
| `GET /api/campaign/active` | backend | REBUILD | Contract uses `/events?is_active=true`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/CampaignController.php` → `backend/src/Controller/EventController.php` (new) |
| `GET /api/admin/campaigns` | backend | REBUILD | Contract uses `/events` admin scope. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/CampaignController.php` → `backend/src/Controller/EventController.php` (new) |
| `POST /api/admin/campaigns` | backend | REBUILD | Contract uses `/events` admin create. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/CampaignController.php` → `backend/src/Controller/EventController.php` (new) |
| `PUT /api/admin/campaigns/{id}` | backend | REBUILD | Contract uses `PATCH /events/:id`. | Implement correct method/path. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/CampaignController.php` → `backend/src/Controller/EventController.php` (new) |
| `POST /api/admin/campaigns/{id}/activate` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/CampaignController.php` → none (drop) |
| `GET /api/teachers/homerooms` | backend | REBUILD | Contract uses `/teachers?is_active=eq.true&teacher_type=eq.homeroom`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/TeacherController.php` → `backend/src/Controller/TeacherController.php` (new) |
| `GET /api/admin/teachers` | backend | REBUILD | Contract uses `/teachers` admin scope. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/TeacherController.php` → `backend/src/Controller/TeacherController.php` (new) |
| `POST /api/admin/teachers` | backend | REBUILD | Contract uses `/teachers` admin create. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/TeacherController.php` → `backend/src/Controller/TeacherController.php` (new) |
| `PUT /api/admin/teachers/{id}` | backend | REBUILD | Contract uses `PATCH /teachers/:id`. | Implement correct method/path. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/TeacherController.php` → `backend/src/Controller/TeacherController.php` (new) |
| `GET /api/teacher/roster` | backend | REBUILD | Contract uses `/children?homeroom_teacher_id=eq.{teacher_id}`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/TeacherController.php` → `backend/src/Controller/TeacherController.php` (new) |
| `POST /api/parent/students` | backend | REBUILD | Contract uses `POST /children`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/ChildrenController.php` (new) |
| `GET /api/parent/students` | backend | REBUILD | Contract uses `GET /children?user_id=eq.{user_id}`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/ChildrenController.php` (new) |
| `GET /api/parent/students/{id}` | backend | REBUILD | Contract uses `GET /children/:id` with relationship-based shaping. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/ChildrenController.php` (new) |
| `PUT /api/parent/students/{id}` | backend | REBUILD | Contract uses `PATCH /children/:id`. | Implement correct method/path. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/ChildrenController.php` (new) |
| `POST /api/parent/students/{id}/re-enroll` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → none (drop) |
| `POST /api/parent/students/{id}/enable-login` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → none (drop) |
| `POST /api/parent/students/{id}/disable-login` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → none (drop) |
| `POST /api/parent/students/{id}/reset-password` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → none (drop) |
| `DELETE /api/parent/students/{id}` | backend | REBUILD | Contract uses `DELETE /children/:id`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/ChildrenController.php` (new) |
| `GET /api/admin/students` | backend | REBUILD | Contract uses `/admin/reports/students` or `/children` admin scope. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/StudentController.php` → `backend/src/Controller/AdminReportsController.php` (new) |
| `POST /api/students/{studentId}/reading-logs` | backend | REBUILD | Contract uses `POST /reading_logs` with student session scoping. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → `backend/src/Controller/ReadingLogsController.php` (new) |
| `GET /api/students/{studentId}/reading-logs` | backend | REBUILD | Contract uses `/me/student/reading-logs` for student. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → `backend/src/Controller/ReadingLogsController.php` (new) |
| `PATCH /api/reading-logs/{logId}` | backend | REBUILD | Contract uses `PATCH /reading_logs/:id`. | Implement correct path. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → `backend/src/Controller/ReadingLogsController.php` (new) |
| `DELETE /api/reading-logs/{logId}` | backend | REBUILD | Contract uses `DELETE /reading_logs/:id`. | Implement correct path. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → `backend/src/Controller/ReadingLogsController.php` (new) |
| `PATCH /api/reading-logs/{logId}/validate` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → none (drop) |
| `PATCH /api/reading-logs/{logId}/lock` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → none (drop) |
| `GET /api/students/{studentId}/reading-summary` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/ReadingLogController.php` → none (drop) |
| `GET /api/books/search` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/BookController.php` → none (drop) |
| `GET /api/books/isbn/{isbn}` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/BookController.php` → none (drop) |
| `POST /api/public/students/{token}/pledges` | backend | REBUILD | Contract uses `/pledges` and `/f/:userId` flow. | Implement contract endpoints. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `GET /api/public/students/{token}/pledges` | backend | REBUILD | Contract uses `/pledges?child_id=in.(...)`. | Implement contract endpoints. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `PATCH /api/public/pledges/{id}` | backend | REBUILD | Contract uses `PATCH /pledges/:id`. | Implement contract endpoints. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `DELETE /api/public/pledges/{id}` | backend | REBUILD | Contract uses `DELETE /pledges/:id`. | Implement contract endpoints. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `GET /api/parent/students/{id}/pledges` | backend | REBUILD | Contract uses `/pledges?child_id=in.(...)`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `GET /api/admin/pledges` | backend | REBUILD | Contract uses `/admin/reports/pledges`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/AdminReportsController.php` (new) |
| `PATCH /api/admin/pledges/{id}/mark-paid` | backend | REBUILD | Contract uses `PATCH /pledges/:id`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PledgeController.php` → `backend/src/Controller/PledgesController.php` (new) |
| `GET /api/admin/payments` | backend | REBUILD | Contract uses `/payments?order=...`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PaymentController.php` → `backend/src/Controller/PaymentsController.php` (new) |
| `POST /api/admin/payments/check` | backend | REBUILD | Contract uses `POST /payments` with payment_method. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PaymentController.php` → `backend/src/Controller/PaymentsController.php` (new) |
| `GET /api/admin/finance/export` | backend | REBUILD | Contract uses `/admin/reports/finance?format=csv`. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PaymentController.php` → `backend/src/Controller/AdminReportsController.php` (new) |
| `POST /api/checkout` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PaymentController.php` → none (drop) |
| `POST /api/webhooks/square` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/PaymentController.php` → none (drop) |
| `POST /api/parent/students/{id}/invite` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/InvitationController.php` → none (drop) |
| `GET /api/parent/students/{id}/invitations` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/InvitationController.php` → none (drop) |
| `GET /api/parent/students/{id}/previous-sponsors` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/InvitationController.php` → none (drop) |
| `GET /api/invite/{token}` | backend | REBUILD | API not defined for invite resolution. | Remove or replace with contract flow. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/InvitationController.php` → none (drop) |
| `GET /api/sponsor/dashboard` | backend | REBUILD | Envelope + scoping mismatch. | Implement contract endpoint with envelope. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/SponsorController.php` → `backend/src/Controller/SponsorController.php` (new) |
| `GET /api/sponsor/unpaid-pledges` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/SponsorController.php` → none (drop) |
| `GET /api/public/returning/{code}` | backend | REBUILD | Not in contract. | Remove or replace with contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/SponsorController.php` → none (drop) |
| `GET /api/admin/sponsors` | backend | REBUILD | Contract uses `/sponsors` admin scope. | Implement contract endpoint. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Controllers/SponsorController.php` → `backend/src/Controller/SponsorController.php` (new) |

## Frontend Routes / Pages

| Item | Type | KEEP/REFACTOR/REBUILD | Why | Required changes | Depends on | Claude source → Main repo target |
|---|---|---|---|---|---|---|
| `/student/login` → `StudentPinLoginPage` | frontend | REBUILD | Claude page is placeholder and doesn’t match UI spec. | Rebuild per `PAGE_COMPOSITION.md`. | UI docs | `claude_reference/frontend/src/pages/student/StudentPinLoginPage.tsx` → `frontend/src/pages/student/StudentPinLoginPage.tsx` |
| `/student/log` → `StudentLogReadingPage` | frontend | REBUILD | Claude page is placeholder and doesn’t match UI spec. | Rebuild per `PAGE_COMPOSITION.md`. | UI docs | `claude_reference/frontend/src/pages/student/StudentLogReadingPage.tsx` → `frontend/src/pages/student/StudentLogReadingPage.tsx` |
| `/student/dashboard` → `StudentPinDashboardPage` | frontend | REBUILD | Claude page is placeholder. | Rebuild per `PAGE_COMPOSITION.md`. | UI docs | `claude_reference/frontend/src/pages/student/StudentPinDashboardPage.tsx` → `frontend/src/pages/student/StudentPinDashboardPage.tsx` |
| `/student/books` → `StudentBooksPage` | frontend | REBUILD | Claude page is placeholder. | Rebuild per `PAGE_COMPOSITION.md`. | UI docs | `claude_reference/frontend/src/pages/student/StudentBooksPage.tsx` → `frontend/src/pages/student/StudentBooksPage.tsx` |
| All other pages (marketing, parent, sponsor, teacher, admin) | frontend | REFACTOR | Requires UI parity + API contract alignment. | Align layout, component usage, and API calls to contract. | UI docs + API contract | `claude_reference/frontend/src/pages/**` → `frontend/src/pages/**` (refactor) |

## Shared UI Components

| Item | Type | KEEP/REFACTOR/REBUILD | Why | Required changes | Depends on | Claude source → Main repo target |
|---|---|---|---|---|---|---|
| Button/Input/Label/FormField | component | REFACTOR | Variants/sizes/states differ from UI spec. | Align to `COMPONENT_SPECS.md`. | UI docs | `claude_reference/frontend/src/components/ui/*` → `frontend/src/components/ui/*` |
| PageHeader/BookContainer/Logo/ReadingGoalRing | component | REFACTOR | Layout/spec mismatches need alignment. | Align to UI docs. | UI docs | `claude_reference/frontend/src/components/**` → `frontend/src/components/**` |
| Layout shells (PublicLayout/MainNav/Footer/BottomTabBar/AdminLayout) | component | REFACTOR | Must match `LAYOUT_SPECS.md`. | Align layout structure + styling. | UI docs | `claude_reference/frontend/src/components/layout/*` → `frontend/src/components/layout/*` |
| BookSelector/MobileMinutesStepper | component | REFACTOR/REBUILD | Must match UI spec; missing mobile stepper. | Build per component spec. | UI docs | `claude_reference/frontend/src/components/books/BookSelector.tsx` → `frontend/src/components/books/BookSelector.tsx` |

## DB Access Layer Patterns

| Item | Type | KEEP/REFACTOR/REBUILD | Why | Required changes | Depends on | Claude source → Main repo target |
|---|---|---|---|---|---|---|
| StudentRepository | backend | REFACTOR | References non-legacy columns (e.g., `students.password`). | Remove unsupported columns; align to schema. | `dbevptgp6jaaqa-2.sql` | `claude_reference/api/Repositories/StudentRepository.php` → `backend/src/Repository/StudentRepository.php` |
| ReadingLogRepository | backend | REFACTOR | Mostly compatible but response mapping + status needs alignment. | Align to contract payloads. | `API_CONTRACT_FINAL.md` | `claude_reference/api/Repositories/ReadingLogRepository.php` → `backend/src/Repository/ReadingLogRepository.php` |
| PledgeRepository | backend | REFACTOR | Writes to non-legacy columns. | Remove unsupported columns or map to legacy. | `dbevptgp6jaaqa-2.sql` | `claude_reference/api/Repositories/PledgeRepository.php` → `backend/src/Repository/PledgeRepository.php` |
| PaymentRepository | backend | REFACTOR | Contract endpoints differ; verify schema. | Align to contract and legacy schema. | `API_CONTRACT_FINAL.md`, `dbevptgp6jaaqa-2.sql` | `claude_reference/api/Repositories/PaymentRepository.php` → `backend/src/Repository/PaymentRepository.php` |
| Other repositories (Teacher, Campaign, Invite, Sponsor, User, Session) | backend | REFACTOR | Need contract + schema alignment. | Align endpoints and queries. | `API_CONTRACT_FINAL.md`, `dbevptgp6jaaqa-2.sql` | `claude_reference/api/Repositories/*` → `backend/src/Repository/*` |

